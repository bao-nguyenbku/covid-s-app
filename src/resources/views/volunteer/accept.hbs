<div class="title">YÊU CẦU BẠN ĐÃ NHẬN</div>
<div class="card-container">
    {{#each orders}}
    <div class="card">
        {{!-- <div class="card-header">
            <img src="https://c0.wallpaperflare.com/preview/483/210/436/car-green-4x4-jeep.jpg" alt="rover" />
        </div> --}}
        <div class="card-body">
            <span class="tag tag-teal1">{{this.quan}}</span>
            <h3>
                {{#each ../items}}
                    {{#if (equal this.order_id ../this.ID)}}
                    {{this.item_name}},
                    {{/if}}
                {{/each}}
            </h3>
            <p>
                {{this.address}}
            </p>
            <div class="user">
                <img src="https://yt3.ggpht.com/a/AGF-l7-0J1G0Ue0mcZMw-99kMeVuBmRxiPjyvIYONg=s900-c-k-c0xffffffff-no-rj-mo"
                    alt="user" />
                <div class="user-info">
                    <h5> {{this.name}} </h5>
                    <small>{{formatDate this.time}}</small>
                </div>
            </div>
            <button type="button" class="btn btn-danger button-detail" data-bs-toggle="modal"
                        data-bs-target="#exampleModal" data-id="{{this.ID}}">Hoàn thành</button>
        </div>
    </div>
    {{/each}}
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Chi tiết yêu cầu bạn đã nhận</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body" id="order-detail">
                <div class="order-detail-title">
                        <p></p>
                        <p></p>
                        <p></p>
                        <p></p>
                </div>
                <hr>            
                <div class="order-detail-body">
                    <h4>Danh sách sản phẩm cần mua</h4>
                        <ul>
                        </ul>
                    </div>
            </div>
                    <hr>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Tổng tiền" aria-label="Recipient's username"
                    aria-describedby="button-addon2">
                <button class="btn btn-danger" type="button" id="button-addon2">Hoàn thành</button>
                </div>
            {{!-- End body of modal --}}
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
    </div>
</div>
<script src="/vendor/jquery/jquery-3.6.0.min.js"></script>
<script>
    function formatDate(date) {
        if (date) {
            let option = { hour: "2-digit", minute: "2-digit", second: "2-digit" };
            return new Date(date).toLocaleDateString("vi-VN", option);
        }
    }
    $(document).ready(function () {
        $('.button-detail').click(function () {
            const id = $(this).data('id');
            console.log(id);
           $.ajax({
                type: 'POST',
                url: '/receive/accept/details',
                data: {id: id},
                dataType: 'json',
                success: function (res) {
                    if (res) {
                        console.log(res.orders, res.order_items, res.customer);
                        $('#order-detail .order-detail-title p:first-child').html(`Mã đơn: <strong>${res.orders[0].id}</strong>`);

                        $('#order-detail .order-detail-title p:nth-child(2)').html(`Đã gửi lúc: <strong>${formatDate(res.orders[0].create_time)}</strong>`);

                        $('#order-detail .order-detail-title p:nth-child(3)').html(`Tên khách hàng: <strong>${res.customer[0].last_name} ${res.customer[0].first_name}</strong>`);
                        
                        $('#order-detail .order-detail-title p:nth-child(4)').html(`Địa chỉ nhận: <span class="badge bg-gradient-dark">${res.orders[0].address}</span>`);

                    }
                     let li = '';
                        for (let i = 0; i < res.order_items.length; ++i) {
                            li += `<li>${res.order_items[i].item_name}:  ${res.order_items[i].quantity}</li>`;
                        }

                        $('#order-detail .order-detail-body ul').html(li);
                    // $('#order-detail').append();
                }
            });
        });
    })
</script>
